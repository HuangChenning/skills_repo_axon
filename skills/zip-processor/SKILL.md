---
name: zip-processor
description: Comprehensive zip file processing workflow for Oracle database inspection packages generated by Bethune. Use when handling zip files in collectdata/ directory - validates integrity, extracts to temp/, and archives to processed/. Handles batch processing, error recovery, and file integrity checks.
---

# Zip Processor

## Overview

Automated workflow for processing Bethune-generated Oracle database inspection zip packages. Validates file integrity, extracts to isolated temp directories, and archives processed files with proper error handling and logging.

## Quick Start

```python
from pathlib import Path
from src.zip_processor import ZipProcessor

processor = ZipProcessor(
    collect_dir=Path('collectdata'),
    temp_dir=Path('temp'),
    processed_dir=Path('processed')
)

result = processor.process_zip_file(Path('collectdata/example.zip'))
print(result)
```

## Core Operations

### Validation

Pre-extraction checks to ensure zip file integrity:

**Check existence**: Verify file exists before processing

**Check size**: Validate file size > 0 bytes

**Check integrity**: Use `zipfile.testzip()` to verify archive is not corrupted

**Error handling**: Mark failed files with `_FAILED` suffix

### Extraction

Extract zip contents to isolated temp directories:

**Unique TaskID**: Generate timestamp-based identifier (e.g., `task_20260210123456`)

**Isolated directory**: Each zip extracts to `temp/{TaskID}/`

**Encoding support**: Handle UTF-8, GBK, and other encodings for file names

**Post-validation**: Verify extraction directory is not empty

### Archiving

Move successfully processed files to date-organized archive:

**Date structure**: Archive to `processed/{YYYYMMDD}/` (e.g., `processed/20260210/`)

**Atomic move**: Use `shutil.move()` for reliable file transfer

**Preserve filename**: Keep original filename in archive

### Error Handling

Comprehensive error handling for all operations:

**ZipFileError**: Bad zip file, password protected, or corrupted archive

**PermissionError**: Insufficient permissions for file operations

**OSError**: File system errors (disk full, path too long, etc.)

**Logging**: Detailed error messages with TaskID, operation type, and timestamp

## Resources

### scripts/

This skill includes Python implementation code:

**zip_processor.py**: Complete ZipProcessor class implementation

```python
class ZipProcessor:
    - generate_task_id() - Create unique task identifier
    - validate_zip_file() - Validate zip integrity
    - extract_zip() - Extract to temp directory
    - archive_zip() - Move to processed archive
    - mark_failed() - Mark failed files
    - process_zip_file() - Full workflow orchestration
    - process_all_zips() - Batch processing
```

**Appropriate for**: Direct execution for reliable file operations without loading into context.

---

**Note**: references/ and assets/ directories are not needed for this skill.
